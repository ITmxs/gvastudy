!function(){function t(t,e,r,i,o,a,n){try{var u=t[a](n),l=u.value}catch(s){return void r(s)}u.done?e(l):Promise.resolve(l).then(i,o)}function e(e){return function(){var r=this,i=arguments;return new Promise((function(o,a){var n=e.apply(r,i);function u(e){t(n,o,a,u,l,"next",e)}function l(e){t(n,o,a,u,l,"throw",e)}u(void 0)}))}}var r=document.createElement("style");r.innerHTML=".authority .el-input-number{margin-left:15px}.authority .el-input-number span{display:none}.role-box .el-tabs__content{height:calc(100vh - 72px);overflow:auto}\n",document.head.appendChild(r),System.register(["./authority-legacy.30081820.js","./menus-legacy.60d8e648.js","./apis-legacy.0016a1be.js","./datas-legacy.8adb5a52.js","./warningBar-legacy.8bc98fe0.js","./infoList-legacy.22629927.js","./index-legacy.2b2c1438.js","./vendor-legacy.89c3086c.js","./api-legacy.bcb3dfac.js","./dictionary-legacy.f4c16c6a.js","./date-legacy.431857fb.js"],(function(t){"use strict";var r,i,o,a,n,u,l,s,d,c,h,f,m,y,p,g,b,w,I,v;return{setters:[function(t){r=t.g,i=t.d,o=t.c,a=t.u,n=t.a},function(t){u=t.default},function(t){l=t.default},function(t){s=t.default},function(t){d=t.w},function(t){c=t.i},function(t){h=t._},function(t){f=t.r,m=t.o,y=t.f,p=t.g,g=t.k,b=t.w,w=t.x,I=t.l,v=t.s},function(){},function(){},function(){}],execute:function(){var x={name:"Authority",components:{Menus:u,Apis:l,Datas:s,warningBar:d},mixins:[c],data:function(){return{AuthorityOption:[{authorityId:"0",authorityName:"根角色"}],listApi:r,drawer:!1,dialogType:"add",activeRow:{},activeUserId:0,dialogTitle:"新增角色",dialogFormVisible:!1,apiDialogFlag:!1,copyForm:{},form:{authorityId:"",authorityName:"",parentId:"0"},rules:{authorityId:[{required:!0,message:"请输入角色ID",trigger:"blur"},{validator:function(t,e,r){return/^[0-9]*[1-9][0-9]*$/.test(e)?r():r(new Error("请输入正整数"))},trigger:"blur"}],authorityName:[{required:!0,message:"请输入角色名",trigger:"blur"}],parentId:[{required:!0,message:"请选择请求方式",trigger:"blur"}]}}},created:function(){var t=this;return e(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.pageSize=999,e.next=3,t.getTableData();case 3:case"end":return e.stop()}}),e)})))()},methods:{changeRow:function(t,e){this.activeRow[t]=e},autoEnter:function(t,e){var r=["menus","apis","datas"];e&&this.$refs[r[e]].needConfirm&&(this.$refs[r[e]].enterAndNext(),this.$refs[r[e]].needConfirm=!1)},copyAuthority:function(t){for(var e in this.setOptions(),this.dialogTitle="拷贝角色",this.dialogType="copy",this.form)this.form[e]=t[e];this.copyForm=t,this.dialogFormVisible=!0},opdendrawer:function(t){this.drawer=!0,this.activeRow=t},deleteAuth:function(t){var r=this;this.$confirm("此操作将永久删除该角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(e(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i({authorityId:t.authorityId});case 2:0===e.sent.code&&(r.$message({type:"success",message:"删除成功!"}),1===r.tableData.length&&r.page>1&&r.page--,r.getTableData());case 4:case"end":return e.stop()}}),e)})))).catch((function(){r.$message({type:"info",message:"已取消删除"})}))},initForm:function(){this.$refs.authorityForm&&this.$refs.authorityForm.resetFields(),this.form={authorityId:"",authorityName:"",parentId:"0"}},closeDialog:function(){this.initForm(),this.dialogFormVisible=!1,this.apiDialogFlag=!1},enterDialog:function(){var t=this;return e(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if("0"!==t.form.authorityId){r.next=3;break}return t.$message({type:"error",message:"角色id不能为0"}),r.abrupt("return",!1);case 3:t.$refs.authorityForm.validate(function(){var r=e(regeneratorRuntime.mark((function e(r){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=26;break}e.t0=t.dialogType,e.next="add"===e.t0?4:"edit"===e.t0?9:"copy"===e.t0?14:24;break;case 4:return e.next=6,n(t.form);case 6:return 0===e.sent.code&&(t.$message({type:"success",message:"添加成功!"}),t.getTableData(),t.closeDialog()),e.abrupt("break",24);case 9:return e.next=11,a(t.form);case 11:return 0===e.sent.code&&(t.$message({type:"success",message:"添加成功!"}),t.getTableData(),t.closeDialog()),e.abrupt("break",24);case 14:return(i={authority:{authorityId:"string",authorityName:"string",datauthorityId:[],parentId:"string"},oldAuthorityId:0}).authority.authorityId=t.form.authorityId,i.authority.authorityName=t.form.authorityName,i.authority.parentId=t.form.parentId,i.authority.dataAuthorityId=t.copyForm.dataAuthorityId,i.oldAuthorityId=t.copyForm.authorityId,e.next=22,o(i);case 22:0===e.sent.code&&(t.$message({type:"success",message:"复制成功！"}),t.getTableData());case 24:t.initForm(),t.dialogFormVisible=!1;case 26:case"end":return e.stop()}}),e)})));return function(t){return r.apply(this,arguments)}}());case 4:case"end":return r.stop()}}),r)})))()},setOptions:function(){this.AuthorityOption=[{authorityId:"0",authorityName:"根角色"}],this.setAuthorityOptions(this.tableData,this.AuthorityOption,!1)},setAuthorityOptions:function(t,e,r){var i=this;this.form.authorityId=String(this.form.authorityId),t&&t.forEach((function(t){if(t.children&&t.children.length){var o={authorityId:t.authorityId,authorityName:t.authorityName,disabled:r||t.authorityId===i.form.authorityId,children:[]};i.setAuthorityOptions(t.children,o.children,r||t.authorityId===i.form.authorityId),e.push(o)}else{var a={authorityId:t.authorityId,authorityName:t.authorityName,disabled:r||t.authorityId===i.form.authorityId};e.push(a)}}))},addAuthority:function(t){this.initForm(),this.dialogTitle="新增角色",this.dialogType="add",this.form.parentId=t,this.setOptions(),this.dialogFormVisible=!0},editAuthority:function(t){for(var e in this.setOptions(),this.dialogTitle="编辑角色",this.dialogType="edit",this.form)this.form[e]=t[e];this.setOptions(),this.dialogFormVisible=!0}}},k={class:"authority"},C={class:"gva-table-box"},A={class:"gva-btn-list"},R=v("新增角色"),F=v("设置权限"),V=v("新增子角色"),_=v("拷贝"),D=v("编辑"),T=v("删除"),N={class:"dialog-footer"},$=v("取 消"),O=v("确 定");t("default",h(x,[["render",function(t,e,r,i,o,a){var n=f("warning-bar"),u=f("el-button"),l=f("el-table-column"),s=f("el-table"),d=f("el-cascader"),c=f("el-form-item"),h=f("el-input"),v=f("el-form"),x=f("el-dialog"),j=f("Menus"),z=f("el-tab-pane"),U=f("Apis"),E=f("Datas"),B=f("el-tabs"),S=f("el-drawer");return m(),y("div",k,[p(n,{title:"注：右上角头像下拉可切换角色"}),g("div",C,[g("div",A,[p(u,{size:"mini",type:"primary",icon:"el-icon-plus",onClick:e[0]||(e[0]=function(t){return a.addAuthority("0")})},{default:b((function(){return[R]})),_:1})]),p(s,{data:t.tableData,"tree-props":{children:"children",hasChildren:"hasChildren"},"row-key":"authorityId",style:{width:"100%"}},{default:b((function(){return[p(l,{label:"角色ID","min-width":"180",prop:"authorityId"}),p(l,{align:"left",label:"角色名称","min-width":"180",prop:"authorityName"}),p(l,{align:"left",label:"操作",width:"460"},{default:b((function(t){return[p(u,{icon:"el-icon-setting",size:"mini",type:"text",onClick:function(e){return a.opdendrawer(t.row)}},{default:b((function(){return[F]})),_:2},1032,["onClick"]),p(u,{icon:"el-icon-plus",size:"mini",type:"text",onClick:function(e){return a.addAuthority(t.row.authorityId)}},{default:b((function(){return[V]})),_:2},1032,["onClick"]),p(u,{icon:"el-icon-copy-document",size:"mini",type:"text",onClick:function(e){return a.copyAuthority(t.row)}},{default:b((function(){return[_]})),_:2},1032,["onClick"]),p(u,{icon:"el-icon-edit",size:"mini",type:"text",onClick:function(e){return a.editAuthority(t.row)}},{default:b((function(){return[D]})),_:2},1032,["onClick"]),p(u,{icon:"el-icon-delete",size:"mini",type:"text",onClick:function(e){return a.deleteAuth(t.row)}},{default:b((function(){return[T]})),_:2},1032,["onClick"])]})),_:1})]})),_:1},8,["data"])]),p(x,{modelValue:o.dialogFormVisible,"onUpdate:modelValue":e[4]||(e[4]=function(t){return o.dialogFormVisible=t}),title:o.dialogTitle},{footer:b((function(){return[g("div",N,[p(u,{size:"small",onClick:a.closeDialog},{default:b((function(){return[$]})),_:1},8,["onClick"]),p(u,{size:"small",type:"primary",onClick:a.enterDialog},{default:b((function(){return[O]})),_:1},8,["onClick"])])]})),default:b((function(){return[p(v,{ref:"authorityForm",model:o.form,rules:o.rules,"label-width":"80px"},{default:b((function(){return[p(c,{label:"父级角色",prop:"parentId"},{default:b((function(){return[p(d,{modelValue:o.form.parentId,"onUpdate:modelValue":e[1]||(e[1]=function(t){return o.form.parentId=t}),style:{width:"100%"},disabled:"add"==o.dialogType,options:o.AuthorityOption,props:{checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},"show-all-levels":!1,filterable:""},null,8,["modelValue","disabled","options"])]})),_:1}),p(c,{label:"角色ID",prop:"authorityId"},{default:b((function(){return[p(h,{modelValue:o.form.authorityId,"onUpdate:modelValue":e[2]||(e[2]=function(t){return o.form.authorityId=t}),disabled:"edit"==o.dialogType,autocomplete:"off"},null,8,["modelValue","disabled"])]})),_:1}),p(c,{label:"角色姓名",prop:"authorityName"},{default:b((function(){return[p(h,{modelValue:o.form.authorityName,"onUpdate:modelValue":e[3]||(e[3]=function(t){return o.form.authorityName=t}),autocomplete:"off"},null,8,["modelValue"])]})),_:1})]})),_:1},8,["model","rules"])]})),_:1},8,["modelValue","title"]),o.drawer?(m(),w(S,{key:0,modelValue:o.drawer,"onUpdate:modelValue":e[5]||(e[5]=function(t){return o.drawer=t}),"with-header":!1,size:"40%",title:"角色配置"},{default:b((function(){return[p(B,{"before-leave":a.autoEnter,class:"role-box",type:"border-card"},{default:b((function(){return[p(z,{label:"角色菜单"},{default:b((function(){return[p(j,{ref:"menus",row:o.activeRow,onChangeRow:a.changeRow},null,8,["row","onChangeRow"])]})),_:1}),p(z,{label:"角色api"},{default:b((function(){return[p(U,{ref:"apis",row:o.activeRow,onChangeRow:a.changeRow},null,8,["row","onChangeRow"])]})),_:1}),p(z,{label:"资源权限"},{default:b((function(){return[p(E,{ref:"datas",authority:t.tableData,row:o.activeRow,onChangeRow:a.changeRow},null,8,["authority","row","onChangeRow"])]})),_:1})]})),_:1},8,["before-leave"])]})),_:1},8,["modelValue"])):I("",!0)])}]]))}}}))}();
