!function(){function e(e,t,n,a,r,i,o){try{var l=e[i](o),c=l.value}catch(u){return void n(u)}l.done?t(c):Promise.resolve(c).then(a,r)}function t(t){return function(){var n=this,a=arguments;return new Promise((function(r,i){var o=t.apply(n,a);function l(t){e(o,r,i,l,c,"next",t)}function c(t){e(o,r,i,l,c,"throw",t)}l(void 0)}))}}function n(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function a(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?n(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var l=document.createElement("style");l.innerHTML=".image-uploader[data-v-4bf0c336]{border:1px dashed #d9d9d9;width:180px;border-radius:6px;cursor:pointer;position:relative;overflow:hidden}.image-uploader[data-v-4bf0c336]{border-color:#409eff}.image-uploader-icon[data-v-4bf0c336]{font-size:28px;color:#8c939d;width:178px;height:178px;line-height:178px;text-align:center}.image[data-v-4bf0c336]{width:178px;height:178px;display:block}.upload-btn+.upload-btn[data-v-512e9724]{margin-left:12px}\n",document.head.appendChild(l),System.register(["./vendor-legacy.89c3086c.js","./infoList-legacy.22629927.js","./fileUploadAndDownload-legacy.ce8887c1.js","./index-legacy.79ad54f2.js","./index-legacy.2b2c1438.js","./dictionary-legacy.f4c16c6a.js","./date-legacy.431857fb.js"],(function(e){"use strict";var n,r,l,c,u,s,d,f,p,g,h,m,v,b,w,y,x,j;return{setters:[function(e){n=e.G,r=e.p,l=e.j,c=e.r,u=e.o,s=e.f,d=e.g,f=e.w,p=e.s,g=e.H,h=e.I,m=e.k,v=e.u},function(e){b=e.i},function(e){w=e.g,y=e.d},function(e){x=e.C},function(e){j=e._},function(){},function(){}],execute:function(){var U=function(e,t){var n=new Image;n.setAttribute("crossOrigin","anonymous"),n.onload=function(){var e=document.createElement("canvas");e.width=n.width,e.height=n.height,e.getContext("2d").drawImage(n,0,0,n.width,n.height);var a=e.toDataURL("image/png"),r=document.createElement("a"),i=new MouseEvent("click");r.download=t||"photo",r.href=a,r.dispatchEvent(i)},n.src=e},k=function(){function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1920;i(this,e),this.file=t,this.fileSize=n,this.maxWH=a}var t,n,a;return t=e,(n=[{key:"compress",value:function(){var e=this,t=this.file.type,n=this.file.size/1024;return new Promise((function(a){var r=new FileReader;r.readAsDataURL(e.file),r.onload=function(){var i=document.createElement("canvas"),o=document.createElement("img");o.src=r.result,o.onload=function(){var r=i.getContext("2d"),l=e.dWH(o.width,o.height,e.maxWH);i.width=l.width,i.height=l.height,r.clearRect(0,0,i.width,i.height),r.drawImage(o,0,0,i.width,i.height);var c=i.toDataURL(t,.9),u=e.fileSizeKB(c);u>e.fileSize&&console.log("图片尺寸太大!"+n+" >> "+u);var s=e.dataURLtoBlob(c,t),d=new File([s],e.file.name);a(d)}}}))}},{key:"dWH",value:function(e,t,n){var a={width:e,height:t};return Math.max(e,t)>n?e>t?(a.width=n,a.height=Math.round(t*(n/e)),a):(a.height=n,a.width=Math.round(e*(n/t)),a):a}},{key:"fileSizeKB",value:function(e){return Math.round(3*e.split(",")[1].length/4/1024)}},{key:"dataURLtoBlob",value:function(e,t){for(var n=atob(e.split(",")[1]),a=e.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(n.length),i=new Uint8Array(r),o=0;o<n.length;o++)i[o]=n.charCodeAt(o);return t&&(a=t),new Blob([r],{type:a,lastModifiedDate:new Date})}}])&&o(t.prototype,n),a&&o(t,a),e}(),z="/api",O={name:"UploadImage",model:{prop:"imageUrl",event:"change"},props:{imageUrl:{type:String,default:""},fileSize:{type:Number,default:2048},maxWH:{type:Number,default:1920}},data:function(){return{path:z}},computed:a(a({},n("user",["userInfo","token"])),{},{showImageUrl:function(){return this.imageUrl&&"http"!==this.imageUrl.slice(0,4)?z+this.imageUrl:this.imageUrl}}),methods:{beforeImageUpload:function(e){var t="image/jpeg"===e.type,n="image/png"===e.type;if(!t&&!n)return this.$message.error("上传头像图片只能是 jpg或png 格式!"),!1;var a=e.size/1024<this.fileSize;return a||new k(e,this.fileSize,this.maxWH).compress()},handleImageSuccess:function(e){var t=e.data;t.file&&(this.$emit("change",t.file.url),this.$emit("on-success"))}}};r("data-v-4bf0c336");var C=p("压缩上传");l();var S={name:"Upload",components:{CustomPic:x,UploadImage:j(O,[["render",function(e,t,n,a,r,i){var o=c("el-button"),l=c("el-upload");return u(),s("div",null,[d(l,{action:"".concat(r.path,"/fileUploadAndDownload/upload"),headers:{"x-token":e.token},"show-file-list":!1,"on-success":i.handleImageSuccess,"before-upload":i.beforeImageUpload,multiple:!1},{default:f((function(){return[d(o,{size:"mini",type:"primary"},{default:f((function(){return[C]})),_:1})]})),_:1},8,["action","headers","on-success","before-upload"])])}],["__scopeId","data-v-4bf0c336"]])},mixins:[b],data:function(){return{fullscreenLoading:!1,listApi:w,path:"/api",tableData:[],imageUrl:""}},computed:a({},n("user",["userInfo","token"])),created:function(){this.getTableData()},methods:{deleteFile:function(e){var n=this;return t(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:n.$confirm("此操作将永久文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(t(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,y(e);case 2:0===t.sent.code&&(n.$message({type:"success",message:"删除成功!"}),1===n.tableData.length&&n.page>1&&n.page--,n.getTableData());case 4:case"end":return t.stop()}}),t)})))).catch((function(){n.$message({type:"info",message:"已取消删除"})}));case 1:case"end":return a.stop()}}),a)})))()},checkFile:function(e){this.fullscreenLoading=!0;var t="image/jpeg"===e.type,n="image/png"===e.type,a=e.size/1024/1024<.5;return t||n||(this.$message.error("上传图片只能是 jpg或png 格式!"),this.fullscreenLoading=!1),a||(this.$message.error("未压缩未见上传图片大小不能超过 500KB，请使用压缩上传"),this.fullscreenLoading=!1),(n||t)&&a},uploadSuccess:function(e){this.fullscreenLoading=!1,0===e.code?(this.$message({type:"success",message:"上传成功"}),0===e.code&&this.getTableData()):this.$message({type:"warning",message:e.msg})},uploadError:function(){this.$message({type:"error",message:"上传失败"}),this.fullscreenLoading=!1},downloadFile:function(e){e.url.indexOf("http://")>-1||e.url.indexOf("https://")>-1?U(e.url,e.name):U(this.path+e.url,e.name)}}};r("data-v-512e9724");var D={class:"gva-table-box"},_={class:"gva-btn-list"},I=p("普通上传"),P=p("下载"),L=p("删除"),E={class:"gva-pagination"};l();e("default",j(S,[["render",function(e,t,n,a,r,i){var o=c("el-button"),l=c("el-upload"),b=c("upload-image"),w=c("CustomPic"),y=c("el-table-column"),x=c("el-tag"),j=c("el-table"),U=c("el-pagination"),k=g("loading");return h((u(),s("div",null,[m("div",D,[m("div",_,[d(l,{action:"".concat(r.path,"/fileUploadAndDownload/upload"),"before-upload":i.checkFile,headers:{"x-token":e.token},"on-error":i.uploadError,"on-success":i.uploadSuccess,"show-file-list":!1,class:"upload-btn"},{default:f((function(){return[d(o,{size:"mini",type:"primary"},{default:f((function(){return[I]})),_:1})]})),_:1},8,["action","before-upload","headers","on-error","on-success"]),d(b,{modelValue:r.imageUrl,"onUpdate:modelValue":t[0]||(t[0]=function(e){return r.imageUrl=e}),"file-size":512,"max-w-h":1080,class:"upload-btn",onOnSuccess:e.getTableData},null,8,["modelValue","onOnSuccess"])]),d(j,{data:r.tableData},{default:f((function(){return[d(y,{align:"left",label:"预览",width:"100"},{default:f((function(e){return[d(w,{"pic-type":"file","pic-src":e.row.url},null,8,["pic-src"])]})),_:1}),d(y,{align:"left",label:"日期",prop:"UpdatedAt",width:"180"},{default:f((function(t){return[m("div",null,v(e.formatDate(t.row.UpdatedAt)),1)]})),_:1}),d(y,{align:"left",label:"文件名",prop:"name",width:"180"}),d(y,{align:"left",label:"链接",prop:"url","min-width":"300"}),d(y,{align:"left",label:"标签",prop:"tag",width:"100"},{default:f((function(e){return[d(x,{type:"jpg"===e.row.tag?"primary":"success","disable-transitions":""},{default:f((function(){return[p(v(e.row.tag),1)]})),_:2},1032,["type"])]})),_:1}),d(y,{align:"left",label:"操作",width:"160"},{default:f((function(e){return[d(o,{size:"small",icon:"el-icon-download",type:"text",onClick:function(t){return i.downloadFile(e.row)}},{default:f((function(){return[P]})),_:2},1032,["onClick"]),d(o,{size:"small",icon:"el-icon-delete",type:"text",onClick:function(t){return i.deleteFile(e.row)}},{default:f((function(){return[L]})),_:2},1032,["onClick"])]})),_:1})]})),_:1},8,["data"]),m("div",E,[d(U,{"current-page":e.page,"page-size":e.pageSize,"page-sizes":[10,30,50,100],style:{float:"right",padding:"20px"},total:e.total,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:e.handleCurrentChange,onSizeChange:e.handleSizeChange},null,8,["current-page","page-size","total","onCurrentChange","onSizeChange"])])])],512)),[[k,r.fullscreenLoading,void 0,{fullscreen:!0,lock:!0}]])}],["__scopeId","data-v-512e9724"]]))}}}))}();
