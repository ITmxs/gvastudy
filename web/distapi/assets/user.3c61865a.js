var e=Object.defineProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,l=(t,a,i)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i,s=(e,t,a)=>new Promise(((i,l)=>{var s=e=>{try{r(a.next(e))}catch(t){l(t)}},o=e=>{try{r(a.throw(e))}catch(t){l(t)}},r=e=>e.done?i(e.value):Promise.resolve(e.value).then(s,o);r((a=a.apply(e,t)).next())}));import{_ as o,t as r,v as n,w as d,x as u}from"./index.bf0eadd2.js";import{g as h}from"./authority.c22e40dc.js";import{i as m}from"./infoList.89930291.js";import{G as p,r as c,o as g,f,g as y,k as b,w as I,s as w}from"./vendor.ab24dc3f.js";import{C as v}from"./index.921bfd6e.js";import{C}from"./index.ef192d5b.js";import{w as k}from"./warningBar.f4c6efa3.js";import"./dictionary.03156ab7.js";import"./date.23f5a973.js";import"./fileUploadAndDownload.176ceac4.js";const U={name:"Api",components:{CustomPic:v,ChooseImg:C,warningBar:k},mixins:[m],data:()=>({listApi:r,path:"/api",authOptions:[],addUserDialog:!1,userInfo:{username:"",password:"",nickName:"",headerImg:"",authorityId:"",authorityIds:[]},rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:5,message:"最低5位字符",trigger:"blur"}],password:[{required:!0,message:"请输入用户密码",trigger:"blur"},{min:6,message:"最低6位字符",trigger:"blur"}],nickName:[{required:!0,message:"请输入用户昵称",trigger:"blur"}],authorityId:[{required:!0,message:"请选择用户角色",trigger:"blur"}]}}),computed:((e,s)=>{for(var o in s||(s={}))a.call(s,o)&&l(e,o,s[o]);if(t)for(var o of t(s))i.call(s,o)&&l(e,o,s[o]);return e})({},p("user",["token"])),watch:{tableData(){this.setAuthorityIds()}},created(){return s(this,null,(function*(){yield this.getTableData();const e=yield h({page:1,pageSize:999});this.setOptions(e.data.list)}))},methods:{setAuthorityIds(){this.tableData&&this.tableData.forEach((e=>{const t=e.authorities&&e.authorities.forEach((e=>e.authorityId));e.authorityIds=t}))},openHeaderChange(){this.$refs.chooseImg.open()},setOptions(e){this.authOptions=[],this.setAuthorityOptions(e,this.authOptions)},setAuthorityOptions(e,t){e&&e.forEach((e=>{if(e.children&&e.children.length){const a={authorityId:e.authorityId,authorityName:e.authorityName,children:[]};this.setAuthorityOptions(e.children,a.children),t.push(a)}else{const a={authorityId:e.authorityId,authorityName:e.authorityName};t.push(a)}}))},deleteUser(e){return s(this,null,(function*(){0===(yield n({id:e.ID})).code&&(this.$message.success("删除成功"),yield this.getTableData(),e.visible=!1)}))},enterAddUserDialog(){return s(this,null,(function*(){this.userInfo.authorityId=this.userInfo.authorityIds[0],this.$refs.userForm.validate((e=>s(this,null,(function*(){if(e){0===(yield d(this.userInfo)).code&&this.$message({type:"success",message:"创建成功"}),yield this.getTableData(),this.closeAddUserDialog()}}))))}))},closeAddUserDialog(){this.$refs.userForm.resetFields(),this.userInfo.headerImg="",this.userInfo.authorityIds=[],this.addUserDialog=!1},addUser(){this.addUserDialog=!0},changeAuthority(e,t){return s(this,null,(function*(){t||this.$nextTick((()=>s(this,null,(function*(){0===(yield u({ID:e.ID,authorityIds:e.authorityIds})).code&&this.$message({type:"success",message:"角色设置成功"})}))))}))}}},D={class:"gva-table-box"},V={class:"gva-btn-list"},x=w("新增用户"),_=b("p",null,"确定要删除此用户吗",-1),A={style:{"text-align":"right","margin-top":"8px"}},O=w("取消"),j=w("确定"),z=w("删除"),N={class:"gva-pagination"},P=["src"],S={key:1,class:"header-img-box"},$={class:"dialog-footer"},T=w("取 消"),q=w("确 定");var E=o(U,[["render",function(e,t,a,i,l,s){const o=c("warning-bar"),r=c("el-button"),n=c("CustomPic"),d=c("el-table-column"),u=c("el-cascader"),h=c("el-popover"),m=c("el-table"),p=c("el-pagination"),w=c("el-input"),v=c("el-form-item"),C=c("el-form"),k=c("el-dialog"),U=c("ChooseImg");return g(),f("div",null,[y(o,{title:"注：右上角头像下拉可切换角色"}),b("div",D,[b("div",V,[y(r,{size:"mini",type:"primary",icon:"el-icon-plus",onClick:s.addUser},{default:I((()=>[x])),_:1},8,["onClick"])]),y(m,{data:e.tableData},{default:I((()=>[y(d,{align:"left",label:"头像","min-width":"50"},{default:I((e=>[y(n,{style:{"margin-top":"8px"},"pic-src":e.row.headerImg},null,8,["pic-src"])])),_:1}),y(d,{align:"left",label:"UUID","min-width":"250",prop:"uuid"}),y(d,{align:"left",label:"用户名","min-width":"150",prop:"userName"}),y(d,{align:"left",label:"昵称","min-width":"150",prop:"nickName"}),y(d,{align:"left",label:"用户角色","min-width":"150"},{default:I((e=>[y(u,{modelValue:e.row.authorityIds,"onUpdate:modelValue":t=>e.row.authorityIds=t,options:l.authOptions,"show-all-levels":!1,"collapse-tags":"",props:{multiple:!0,checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},clearable:!1,onVisibleChange:t=>{s.changeAuthority(e.row,t)},onRemoveTag:()=>{s.changeAuthority(e.row,!1)}},null,8,["modelValue","onUpdate:modelValue","options","onVisibleChange","onRemoveTag"])])),_:1}),y(d,{align:"left",label:"操作","min-width":"150"},{default:I((e=>[y(h,{visible:e.row.visible,placement:"top",width:"160"},{reference:I((()=>[y(r,{type:"text",icon:"el-icon-delete",size:"mini"},{default:I((()=>[z])),_:1})])),default:I((()=>[_,b("div",A,[y(r,{size:"mini",type:"text",onClick:t=>e.row.visible=!1},{default:I((()=>[O])),_:2},1032,["onClick"]),y(r,{type:"primary",size:"mini",onClick:t=>s.deleteUser(e.row)},{default:I((()=>[j])),_:2},1032,["onClick"])])])),_:2},1032,["visible"])])),_:1})])),_:1},8,["data"]),b("div",N,[y(p,{"current-page":e.page,"page-size":e.pageSize,"page-sizes":[10,30,50,100],total:e.total,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:e.handleCurrentChange,onSizeChange:e.handleSizeChange},null,8,["current-page","page-size","total","onCurrentChange","onSizeChange"])])]),y(k,{modelValue:l.addUserDialog,"onUpdate:modelValue":t[5]||(t[5]=e=>l.addUserDialog=e),"custom-class":"user-dialog",title:"新增用户"},{footer:I((()=>[b("div",$,[y(r,{size:"small",onClick:s.closeAddUserDialog},{default:I((()=>[T])),_:1},8,["onClick"]),y(r,{size:"small",type:"primary",onClick:s.enterAddUserDialog},{default:I((()=>[q])),_:1},8,["onClick"])])])),default:I((()=>[y(C,{ref:"userForm",rules:l.rules,model:l.userInfo,"label-width":"80px"},{default:I((()=>[y(v,{label:"用户名",prop:"username"},{default:I((()=>[y(w,{modelValue:l.userInfo.username,"onUpdate:modelValue":t[0]||(t[0]=e=>l.userInfo.username=e)},null,8,["modelValue"])])),_:1}),y(v,{label:"密码",prop:"password"},{default:I((()=>[y(w,{modelValue:l.userInfo.password,"onUpdate:modelValue":t[1]||(t[1]=e=>l.userInfo.password=e)},null,8,["modelValue"])])),_:1}),y(v,{label:"别名",prop:"nickName"},{default:I((()=>[y(w,{modelValue:l.userInfo.nickName,"onUpdate:modelValue":t[2]||(t[2]=e=>l.userInfo.nickName=e)},null,8,["modelValue"])])),_:1}),y(v,{label:"用户角色",prop:"authorityId"},{default:I((()=>[y(u,{modelValue:l.userInfo.authorityIds,"onUpdate:modelValue":t[3]||(t[3]=e=>l.userInfo.authorityIds=e),style:{width:"100%"},options:l.authOptions,"show-all-levels":!1,props:{multiple:!0,checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},clearable:!1},null,8,["modelValue","options"])])),_:1}),y(v,{label:"头像","label-width":"80px"},{default:I((()=>[b("div",{style:{display:"inline-block"},onClick:t[4]||(t[4]=(...e)=>s.openHeaderChange&&s.openHeaderChange(...e))},[l.userInfo.headerImg?(g(),f("img",{key:0,class:"header-img-box",src:l.userInfo.headerImg&&"http"!==l.userInfo.headerImg.slice(0,4)?l.path+l.userInfo.headerImg:l.userInfo.headerImg},null,8,P)):(g(),f("div",S,"从媒体库选择"))])])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["modelValue"]),y(U,{ref:"chooseImg",target:l.userInfo,"target-key":"headerImg"},null,8,["target"])])}]]);export{E as default};
