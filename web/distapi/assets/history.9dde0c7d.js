var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,a=(t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i;import{G as n,r as l,o as h,f as u,g as c,w as m,F as y,A as p,L as f,I as d,M as b,k as g,B as v,x as V,s as S,u as x}from"./vendor.ab24dc3f.js";import{_ as O,e as I}from"./index.bf0eadd2.js";const C=e=>e.name+JSON.stringify(e.query)+JSON.stringify(e.params),$={name:"HistoryComponent",data:()=>({historys:[],activeValue:"",contextMenuVisible:!1,left:0,top:0,isCollapse:!1,isMobile:!1,rightActive:""}),computed:(q=((e,t)=>{for(var s in t||(t={}))o.call(t,s)&&a(e,s,t[s]);if(i)for(var s of i(t))r.call(t,s)&&a(e,s,t[s]);return e})({},n("user",["userInfo","activeColor"])),A={defaultRouter(){return this.userInfo.authority.defaultRouter}},t(q,s(A))),watch:{contextMenuVisible(){this.contextMenuVisible?document.body.addEventListener("click",(()=>{this.contextMenuVisible=!1})):document.body.removeEventListener("click",(()=>{this.contextMenuVisible=!1}))},$route(e,t){"Login"!==e.name&&(this.historys=this.historys.filter((e=>!e.meta.closeTab)),this.setTab(e),sessionStorage.setItem("historys",JSON.stringify(this.historys)),this.activeValue=window.sessionStorage.getItem("activeValue"),t&&e&&t.name===e.name&&I.emit("reload"))}},created(){I.on("closeThisPage",(()=>{this.removeTab(this.name(this.$route))})),I.on("closeAllPage",(()=>{this.closeAll()})),I.on("mobile",(e=>{this.isMobile=e})),I.on("collapse",(e=>{this.isCollapse=e}));const e=[{name:this.defaultRouter,meta:{title:"首页"},query:{},params:{}}];this.historys=JSON.parse(sessionStorage.getItem("historys"))||e,window.sessionStorage.getItem("activeValue")?this.activeValue=window.sessionStorage.getItem("activeValue"):this.activeValue=C(this.$route),this.setTab(this.$route)},beforeDestroy(){I.off("collapse"),I.off("mobile")},methods:{name:e=>e.name+JSON.stringify(e.query)+JSON.stringify(e.params),openContextMenu(e){if(1===this.historys.length&&this.$route.name===this.defaultRouter)return!1;let t="";if(t="SPAN"===e.srcElement.nodeName?e.srcElement.offsetParent.id:e.srcElement.id,t){let s;this.contextMenuVisible=!0,s=this.isCollapse?54:220,this.isMobile&&(s=0),this.left=e.clientX-s,this.top=e.clientY+10,this.rightActive=t.split("-")[1]}},closeAll(){this.historys=[{name:this.defaultRouter,meta:{title:"首页"},query:{},params:{}}],this.$router.push({name:this.defaultRouter}),this.contextMenuVisible=!1,sessionStorage.setItem("historys",JSON.stringify(this.historys))},closeLeft(){let e;const t=this.historys.findIndex((t=>(C(t)===this.rightActive&&(e=t),C(t)===this.rightActive))),s=this.historys.findIndex((e=>C(e)===this.activeValue));this.historys.splice(0,t),t>s&&this.$router.push(e),sessionStorage.setItem("historys",JSON.stringify(this.historys))},closeRight(){let e;const t=this.historys.findIndex((t=>(C(t)===this.rightActive&&(e=t),C(t)===this.rightActive))),s=this.historys.findIndex((e=>C(e)===this.activeValue));this.historys.splice(t+1,this.historys.length),t<s&&this.$router.push(e),sessionStorage.setItem("historys",JSON.stringify(this.historys))},closeOther(){let e;this.historys=this.historys.filter((t=>(C(t)===this.rightActive&&(e=t),C(t)===this.rightActive))),this.$router.push(e),sessionStorage.setItem("historys",JSON.stringify(this.historys))},isSame(e,t){if(e.name!==t.name)return!1;for(const s in e.query)if(e.query[s]!==t.query[s])return!1;for(const s in e.params)if(e.params[s]!==t.params[s])return!1;return!0},setTab(e){if(!this.historys.some((t=>this.isSame(t,e)))){const t={};t.name=e.name,t.meta=e.meta,t.query=e.query,t.params=e.params,this.historys.push(t)}window.sessionStorage.setItem("activeValue",C(this.$route))},changeTab(e){const t=e.instance.attrs.tab;this.$router.push({name:t.name,query:t.query,params:t.params})},removeTab(e){const t=this.historys.findIndex((t=>C(t)===e));C(this.$route)===e&&(1===this.historys.length?this.$router.push({name:this.defaultRouter}):t<this.historys.length-1?this.$router.push({name:this.historys[t+1].name,query:this.historys[t+1].query,params:this.historys[t+1].params}):this.$router.push({name:this.historys[t-1].name,query:this.historys[t-1].query,params:this.historys[t-1].params})),this.historys.splice(t,1)}}};var q,A;const w={class:"router-history"};var M=O($,[["render",function(e,t,s,i,o,r){const a=l("el-tab-pane"),n=l("el-tabs");return h(),u("div",w,[c(n,{modelValue:o.activeValue,"onUpdate:modelValue":t[0]||(t[0]=e=>o.activeValue=e),closable:!(1===o.historys.length&&e.$route.name===r.defaultRouter),type:"card",onContextmenu:t[1]||(t[1]=f((e=>r.openContextMenu(e)),["prevent"])),onTabClick:r.changeTab,onTabRemove:r.removeTab},{default:m((()=>[(h(!0),u(y,null,p(o.historys,(t=>(h(),V(a,{key:r.name(t),label:t.meta.title,name:r.name(t),tab:t,class:"gva-tab"},{label:m((()=>[g("span",{style:v({color:o.activeValue===r.name(t)?e.activeColor:"#333"})},[g("i",{class:"dot",style:v({backgroundColor:o.activeValue===r.name(t)?e.activeColor:"#ddd"})},null,4),S(" "+x(t.meta.title),1)],4)])),_:2},1032,["label","name","tab"])))),128))])),_:1},8,["modelValue","closable","onTabClick","onTabRemove"]),d(g("ul",{style:v({left:o.left+"px",top:o.top+"px"}),class:"contextmenu"},[g("li",{onClick:t[2]||(t[2]=(...e)=>r.closeAll&&r.closeAll(...e))},"关闭所有"),g("li",{onClick:t[3]||(t[3]=(...e)=>r.closeLeft&&r.closeLeft(...e))},"关闭左侧"),g("li",{onClick:t[4]||(t[4]=(...e)=>r.closeRight&&r.closeRight(...e))},"关闭右侧"),g("li",{onClick:t[5]||(t[5]=(...e)=>r.closeOther&&r.closeOther(...e))},"关闭其他")],4),[[b,o.contextMenuVisible]])])}]]);export{M as default};
