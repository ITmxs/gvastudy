var t=(t,e,i)=>new Promise(((a,o)=>{var r=t=>{try{l(i.next(t))}catch(e){o(e)}},s=t=>{try{l(i.throw(t))}catch(e){o(e)}},l=t=>t.done?a(t.value):Promise.resolve(t.value).then(r,s);l((i=i.apply(t,e)).next())}));import{g as e,d as i,c as a,u as o,a as r}from"./authority.c22e40dc.js";import s from"./menus.7b1442ce.js";import l from"./apis.2944dda7.js";import d from"./datas.db0392a9.js";import{w as h}from"./warningBar.f4c6efa3.js";import{i as n}from"./infoList.89930291.js";import{_ as u}from"./index.bf0eadd2.js";import{r as m,o as y,f as c,g as p,k as f,w as g,x as b,l as w,s as I}from"./vendor.ab24dc3f.js";import"./api.ae6d84db.js";import"./dictionary.03156ab7.js";import"./date.23f5a973.js";const v={name:"Authority",components:{Menus:s,Apis:l,Datas:d,warningBar:h},mixins:[n],data:()=>({AuthorityOption:[{authorityId:"0",authorityName:"根角色"}],listApi:e,drawer:!1,dialogType:"add",activeRow:{},activeUserId:0,dialogTitle:"新增角色",dialogFormVisible:!1,apiDialogFlag:!1,copyForm:{},form:{authorityId:"",authorityName:"",parentId:"0"},rules:{authorityId:[{required:!0,message:"请输入角色ID",trigger:"blur"},{validator:(t,e,i)=>/^[0-9]*[1-9][0-9]*$/.test(e)?i():i(new Error("请输入正整数")),trigger:"blur"}],authorityName:[{required:!0,message:"请输入角色名",trigger:"blur"}],parentId:[{required:!0,message:"请选择请求方式",trigger:"blur"}]}}),created(){return t(this,null,(function*(){this.pageSize=999,yield this.getTableData()}))},methods:{changeRow(t,e){this.activeRow[t]=e},autoEnter(t,e){const i=["menus","apis","datas"];e&&this.$refs[i[e]].needConfirm&&(this.$refs[i[e]].enterAndNext(),this.$refs[i[e]].needConfirm=!1)},copyAuthority(t){this.setOptions(),this.dialogTitle="拷贝角色",this.dialogType="copy";for(const e in this.form)this.form[e]=t[e];this.copyForm=t,this.dialogFormVisible=!0},opdendrawer(t){this.drawer=!0,this.activeRow=t},deleteAuth(e){this.$confirm("此操作将永久删除该角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>t(this,null,(function*(){0===(yield i({authorityId:e.authorityId})).code&&(this.$message({type:"success",message:"删除成功!"}),1===this.tableData.length&&this.page>1&&this.page--,this.getTableData())})))).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},initForm(){this.$refs.authorityForm&&this.$refs.authorityForm.resetFields(),this.form={authorityId:"",authorityName:"",parentId:"0"}},closeDialog(){this.initForm(),this.dialogFormVisible=!1,this.apiDialogFlag=!1},enterDialog(){return t(this,null,(function*(){if("0"===this.form.authorityId)return this.$message({type:"error",message:"角色id不能为0"}),!1;this.$refs.authorityForm.validate((e=>t(this,null,(function*(){if(e){switch(this.dialogType){case"add":0===(yield r(this.form)).code&&(this.$message({type:"success",message:"添加成功!"}),this.getTableData(),this.closeDialog());break;case"edit":0===(yield o(this.form)).code&&(this.$message({type:"success",message:"添加成功!"}),this.getTableData(),this.closeDialog());break;case"copy":{const t={authority:{authorityId:"string",authorityName:"string",datauthorityId:[],parentId:"string"},oldAuthorityId:0};t.authority.authorityId=this.form.authorityId,t.authority.authorityName=this.form.authorityName,t.authority.parentId=this.form.parentId,t.authority.dataAuthorityId=this.copyForm.dataAuthorityId,t.oldAuthorityId=this.copyForm.authorityId;0===(yield a(t)).code&&(this.$message({type:"success",message:"复制成功！"}),this.getTableData())}}this.initForm(),this.dialogFormVisible=!1}}))))}))},setOptions(){this.AuthorityOption=[{authorityId:"0",authorityName:"根角色"}],this.setAuthorityOptions(this.tableData,this.AuthorityOption,!1)},setAuthorityOptions(t,e,i){this.form.authorityId=String(this.form.authorityId),t&&t.forEach((t=>{if(t.children&&t.children.length){const a={authorityId:t.authorityId,authorityName:t.authorityName,disabled:i||t.authorityId===this.form.authorityId,children:[]};this.setAuthorityOptions(t.children,a.children,i||t.authorityId===this.form.authorityId),e.push(a)}else{const a={authorityId:t.authorityId,authorityName:t.authorityName,disabled:i||t.authorityId===this.form.authorityId};e.push(a)}}))},addAuthority(t){this.initForm(),this.dialogTitle="新增角色",this.dialogType="add",this.form.parentId=t,this.setOptions(),this.dialogFormVisible=!0},editAuthority(t){this.setOptions(),this.dialogTitle="编辑角色",this.dialogType="edit";for(const e in this.form)this.form[e]=t[e];this.setOptions(),this.dialogFormVisible=!0}}},A={class:"authority"},C={class:"gva-table-box"},F={class:"gva-btn-list"},V=I("新增角色"),D=I("设置权限"),k=I("新增子角色"),_=I("拷贝"),T=I("编辑"),N=I("删除"),x={class:"dialog-footer"},R=I("取 消"),$=I("确 定");var O=u(v,[["render",function(t,e,i,a,o,r){const s=m("warning-bar"),l=m("el-button"),d=m("el-table-column"),h=m("el-table"),n=m("el-cascader"),u=m("el-form-item"),I=m("el-input"),v=m("el-form"),O=m("el-dialog"),j=m("Menus"),z=m("el-tab-pane"),U=m("Apis"),B=m("Datas"),E=m("el-tabs"),q=m("el-drawer");return y(),c("div",A,[p(s,{title:"注：右上角头像下拉可切换角色"}),f("div",C,[f("div",F,[p(l,{size:"mini",type:"primary",icon:"el-icon-plus",onClick:e[0]||(e[0]=t=>r.addAuthority("0"))},{default:g((()=>[V])),_:1})]),p(h,{data:t.tableData,"tree-props":{children:"children",hasChildren:"hasChildren"},"row-key":"authorityId",style:{width:"100%"}},{default:g((()=>[p(d,{label:"角色ID","min-width":"180",prop:"authorityId"}),p(d,{align:"left",label:"角色名称","min-width":"180",prop:"authorityName"}),p(d,{align:"left",label:"操作",width:"460"},{default:g((t=>[p(l,{icon:"el-icon-setting",size:"mini",type:"text",onClick:e=>r.opdendrawer(t.row)},{default:g((()=>[D])),_:2},1032,["onClick"]),p(l,{icon:"el-icon-plus",size:"mini",type:"text",onClick:e=>r.addAuthority(t.row.authorityId)},{default:g((()=>[k])),_:2},1032,["onClick"]),p(l,{icon:"el-icon-copy-document",size:"mini",type:"text",onClick:e=>r.copyAuthority(t.row)},{default:g((()=>[_])),_:2},1032,["onClick"]),p(l,{icon:"el-icon-edit",size:"mini",type:"text",onClick:e=>r.editAuthority(t.row)},{default:g((()=>[T])),_:2},1032,["onClick"]),p(l,{icon:"el-icon-delete",size:"mini",type:"text",onClick:e=>r.deleteAuth(t.row)},{default:g((()=>[N])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])]),p(O,{modelValue:o.dialogFormVisible,"onUpdate:modelValue":e[4]||(e[4]=t=>o.dialogFormVisible=t),title:o.dialogTitle},{footer:g((()=>[f("div",x,[p(l,{size:"small",onClick:r.closeDialog},{default:g((()=>[R])),_:1},8,["onClick"]),p(l,{size:"small",type:"primary",onClick:r.enterDialog},{default:g((()=>[$])),_:1},8,["onClick"])])])),default:g((()=>[p(v,{ref:"authorityForm",model:o.form,rules:o.rules,"label-width":"80px"},{default:g((()=>[p(u,{label:"父级角色",prop:"parentId"},{default:g((()=>[p(n,{modelValue:o.form.parentId,"onUpdate:modelValue":e[1]||(e[1]=t=>o.form.parentId=t),style:{width:"100%"},disabled:"add"==o.dialogType,options:o.AuthorityOption,props:{checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},"show-all-levels":!1,filterable:""},null,8,["modelValue","disabled","options"])])),_:1}),p(u,{label:"角色ID",prop:"authorityId"},{default:g((()=>[p(I,{modelValue:o.form.authorityId,"onUpdate:modelValue":e[2]||(e[2]=t=>o.form.authorityId=t),disabled:"edit"==o.dialogType,autocomplete:"off"},null,8,["modelValue","disabled"])])),_:1}),p(u,{label:"角色姓名",prop:"authorityName"},{default:g((()=>[p(I,{modelValue:o.form.authorityName,"onUpdate:modelValue":e[3]||(e[3]=t=>o.form.authorityName=t),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),o.drawer?(y(),b(q,{key:0,modelValue:o.drawer,"onUpdate:modelValue":e[5]||(e[5]=t=>o.drawer=t),"with-header":!1,size:"40%",title:"角色配置"},{default:g((()=>[p(E,{"before-leave":r.autoEnter,class:"role-box",type:"border-card"},{default:g((()=>[p(z,{label:"角色菜单"},{default:g((()=>[p(j,{ref:"menus",row:o.activeRow,onChangeRow:r.changeRow},null,8,["row","onChangeRow"])])),_:1}),p(z,{label:"角色api"},{default:g((()=>[p(U,{ref:"apis",row:o.activeRow,onChangeRow:r.changeRow},null,8,["row","onChangeRow"])])),_:1}),p(z,{label:"资源权限"},{default:g((()=>[p(B,{ref:"datas",authority:t.tableData,row:o.activeRow,onChangeRow:r.changeRow},null,8,["authority","row","onChangeRow"])])),_:1})])),_:1},8,["before-leave"])])),_:1},8,["modelValue"])):w("",!0)])}]]);export{O as default};
