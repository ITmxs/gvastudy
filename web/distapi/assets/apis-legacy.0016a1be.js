!function(){function e(e,t,r,n,a,i,o){try{var c=e[i](o),u=c.value}catch(s){return void r(s)}c.done?t(u):Promise.resolve(u).then(n,a)}function t(t){return function(){var r=this,n=arguments;return new Promise((function(a,i){var o=t.apply(r,n);function c(t){e(o,a,i,c,u,"next",t)}function u(t){e(o,a,i,c,u,"throw",t)}c(void 0)}))}}System.register(["./api-legacy.bcb3dfac.js","./index-legacy.2b2c1438.js","./vendor-legacy.89c3086c.js"],(function(e){"use strict";var r,n,a,i,o,c,u,s,p,d;return{setters:[function(e){r=e.e},function(e){n=e.s,a=e._},function(e){i=e.r,o=e.o,c=e.f,u=e.k,s=e.g,p=e.w,d=e.s}],execute:function(){var h={name:"Apis",props:{row:{default:function(){return{}},type:Object}},data:function(){return{apiTreeData:[],apiTreeIds:[],needConfirm:!1,apiDefaultProps:{children:"children",label:"description"}}},created:function(){var e=this;return t(regeneratorRuntime.mark((function t(){var a,i,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r();case 2:return a=t.sent,i=a.data.apis,e.apiTreeData=e.buildApiTree(i),t.next=7,c={authorityId:e.row.authorityId},n({url:"/casbin/getPolicyPathByAuthorityId",method:"post",data:c});case 7:o=t.sent,e.activeUserId=e.row.authorityId,e.apiTreeIds=[],o.data.paths&&o.data.paths.forEach((function(t){e.apiTreeIds.push("p:"+t.path+"m:"+t.method)}));case 11:case"end":return t.stop()}var c}),t)})))()},methods:{nodeChange:function(){this.needConfirm=!0},enterAndNext:function(){this.authApiEnter()},buildApiTree:function(e){var t={};e&&e.forEach((function(e){e.onlyId="p:"+e.path+"m:"+e.method,Object.prototype.hasOwnProperty.call(t,e.apiGroup)?t[e.apiGroup].push(e):Object.assign(t,function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}({},e.apiGroup,[e]))}));var r=[];for(var n in t){var a={ID:n,description:n+"组",children:t[n]};r.push(a)}return r},authApiEnter:function(){var e=this;return t(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.$refs.apiTree.getCheckedNodes(!0),a=[],r&&r.forEach((function(e){var t={path:e.path,method:e.method};a.push(t)})),t.next=5,i={authorityId:e.activeUserId,casbinInfos:a},n({url:"/casbin/updateCasbin",method:"post",data:i});case 5:0===t.sent.code&&e.$message({type:"success",message:"api设置成功"});case 7:case"end":return t.stop()}var i}),t)})))()}}},f={class:"clearflex"},l=d("确 定");e("default",a(h,[["render",function(e,t,r,n,a,d){var h=i("el-button"),v=i("el-tree");return o(),c("div",null,[u("div",f,[s(h,{class:"fl-right",size:"mini",type:"primary",onClick:d.authApiEnter},{default:p((function(){return[l]})),_:1},8,["onClick"])]),s(v,{ref:"apiTree",data:a.apiTreeData,"default-checked-keys":a.apiTreeIds,props:a.apiDefaultProps,"default-expand-all":"","highlight-current":"","node-key":"onlyId","show-checkbox":"",onCheck:d.nodeChange},null,8,["data","default-checked-keys","props","onCheck"])])}]]))}}}))}();
