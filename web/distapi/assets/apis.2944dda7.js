var e=(e,t,a)=>new Promise(((r,s)=>{var i=e=>{try{n(a.next(e))}catch(t){s(t)}},o=e=>{try{n(a.throw(e))}catch(t){s(t)}},n=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);n((a=a.apply(e,t)).next())}));import{e as t}from"./api.ae6d84db.js";import{s as a,_ as r}from"./index.bf0eadd2.js";import{r as s,o as i,f as o,k as n,g as d,w as p,s as h}from"./vendor.ab24dc3f.js";const c={name:"Apis",props:{row:{default:function(){return{}},type:Object}},data:()=>({apiTreeData:[],apiTreeIds:[],needConfirm:!1,apiDefaultProps:{children:"children",label:"description"}}),created(){return e(this,null,(function*(){const e=(yield t()).data.apis;this.apiTreeData=this.buildApiTree(e);const r=yield(s={authorityId:this.row.authorityId},a({url:"/casbin/getPolicyPathByAuthorityId",method:"post",data:s}));var s;this.activeUserId=this.row.authorityId,this.apiTreeIds=[],r.data.paths&&r.data.paths.forEach((e=>{this.apiTreeIds.push("p:"+e.path+"m:"+e.method)}))}))},methods:{nodeChange(){this.needConfirm=!0},enterAndNext(){this.authApiEnter()},buildApiTree(e){const t={};e&&e.forEach((e=>{e.onlyId="p:"+e.path+"m:"+e.method,Object.prototype.hasOwnProperty.call(t,e.apiGroup)?t[e.apiGroup].push(e):Object.assign(t,{[e.apiGroup]:[e]})}));const a=[];for(const r in t){const e={ID:r,description:r+"组",children:t[r]};a.push(e)}return a},authApiEnter(){return e(this,null,(function*(){const e=this.$refs.apiTree.getCheckedNodes(!0);var t=[];e&&e.forEach((e=>{var a={path:e.path,method:e.method};t.push(a)}));var r;0===(yield(r={authorityId:this.activeUserId,casbinInfos:t},a({url:"/casbin/updateCasbin",method:"post",data:r}))).code&&this.$message({type:"success",message:"api设置成功"})}))}}},l={class:"clearflex"},u=h("确 定");var f=r(c,[["render",function(e,t,a,r,h,c){const f=s("el-button"),m=s("el-tree");return i(),o("div",null,[n("div",l,[d(f,{class:"fl-right",size:"mini",type:"primary",onClick:c.authApiEnter},{default:p((()=>[u])),_:1},8,["onClick"])]),d(m,{ref:"apiTree",data:h.apiTreeData,"default-checked-keys":h.apiTreeIds,props:h.apiDefaultProps,"default-expand-all":"","highlight-current":"","node-key":"onlyId","show-checkbox":"",onCheck:c.nodeChange},null,8,["data","default-checked-keys","props","onCheck"])])}]]);export{f as default};
